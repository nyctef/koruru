<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Soundboard (audiosurf clone) (temporary name): src/modes/cPlayMode.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>src/modes/cPlayMode.cpp</h1><a href="cPlayMode_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="cPlayMode_8h.html">cPlayMode.h</a>"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a><a class="code" href="classcPlayMode.html#53afdb533dd620dab5d7fb3acdbd432c">00003</a> <a class="code" href="classcPlayMode.html#53afdb533dd620dab5d7fb3acdbd432c">cPlayMode::cPlayMode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name) : <a class="code" href="includes_8h.html#c4b138ed97ccda9657544de38c9d69d9">ship</a>(<a class="code" href="main_8cpp.html#8cb10d7dc134fb28d60afb44f43d4db9">ship_model</a>, <a class="code" href="main_8cpp.html#1dcc4c751312e83f33e6be560fe1c15d">bpm</a>), <a class="code" href="classiGameMode.html">iGameMode</a>(name) {
<a name="l00004"></a>00004         <a class="code" href="classcPlayMode.html#bd1bf3742024993a1aaee6fc70d9e582">font</a> = <span class="keyword">new</span> <a class="code" href="classcFont.html" title="Creates and renders a texture-mapped bitmap fixed-width font.">cFont</a>(<span class="stringliteral">"data/font3.png"</span>, 14, 32, <span class="stringliteral">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789[]()^Â£"</span><span class="stringliteral">"';:#"</span>);
<a name="l00005"></a>00005         <a class="code" href="classcPlayMode.html#10bf623113220fed3280c2c119116531">trackdisp</a> = <a class="code" href="classcPlayMode.html#2fd1772ddc1b0c497e42e211fc062ed1">pickupcount</a> = 0; 
<a name="l00006"></a>00006         
<a name="l00007"></a>00007         <a class="code" href="classcPlayMode.html#5cc183c54a1035c87f5a2cdd02b08ece">newobjecttimer</a> = SDL_GetTicks();
<a name="l00008"></a>00008         <a class="code" href="classcPlayMode.html#de014c8a7beb686a36ea11ae5be57116">quit_createpickup_thread</a> = <span class="keyword">false</span>;
<a name="l00009"></a>00009         
<a name="l00010"></a>00010         <a class="code" href="classcPlayMode.html#0f3eefd8ebff420fe1f1dd5f75c70688">createpickup_thread</a> = NULL;
<a name="l00011"></a>00011         
<a name="l00012"></a>00012 }
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="classcPlayMode.html#e4650c4db7ad3ee83070d2bd9dcb29a1">00014</a> <a class="code" href="classcPlayMode.html#e4650c4db7ad3ee83070d2bd9dcb29a1">cPlayMode::~cPlayMode</a>() {
<a name="l00015"></a>00015         <a class="code" href="classcPlayMode.html#de014c8a7beb686a36ea11ae5be57116">quit_createpickup_thread</a> = <span class="keyword">true</span>;
<a name="l00016"></a>00016         SDL_WaitThread(<a class="code" href="classcPlayMode.html#0f3eefd8ebff420fe1f1dd5f75c70688">createpickup_thread</a>, NULL);
<a name="l00017"></a>00017 }
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a><a class="code" href="classcPlayMode.html#6d58169ee910f126d12b826ae865328a">00020</a> <span class="keywordtype">int</span> <a class="code" href="classcPlayMode.html#6d58169ee910f126d12b826ae865328a">cPlayMode::init</a>() {
<a name="l00021"></a>00021         
<a name="l00022"></a>00022         <a class="code" href="includes_8cpp.html#ff964b67fcabe155d88dff5b06278f69" title="Set common GL variables to predetermined sets of values.">InitMode</a>(<a class="code" href="includes_8h.html#9a3de7c5e89b21dec1c78d77c43d8fe9">RESET_MODE</a> | <a class="code" href="includes_8h.html#0e6eed752f69ec92baec7d38a6ff3f04">GAME_MODE</a>);
<a name="l00023"></a>00023         <a class="code" href="main_8cpp.html#e3496037f16ba1b4bde4864dc219e026">score</a> = 0;
<a name="l00024"></a>00024         <a class="code" href="main_8cpp.html#7f7e4724cf57d59513b39c5ecc81adc8">speed</a> = 1*<a class="code" href="main_8cpp.html#1dcc4c751312e83f33e6be560fe1c15d">bpm</a>/60;
<a name="l00025"></a>00025         <span class="keywordflow">if</span> (<a class="code" href="classcPlayMode.html#0f3eefd8ebff420fe1f1dd5f75c70688">createpickup_thread</a> == NULL) <a class="code" href="classcPlayMode.html#0f3eefd8ebff420fe1f1dd5f75c70688">createpickup_thread</a> = SDL_CreateThread(<a class="code" href="cPlayMode_8cpp.html#3d00ff2c7c81826b98c3c861c1a9d416">generate_pickups_thread</a>, (<span class="keywordtype">void</span>*)<span class="keyword">this</span>);
<a name="l00026"></a>00026         <span class="keywordflow">return</span> 0;
<a name="l00027"></a>00027                 
<a name="l00028"></a>00028         <span class="comment">// OH EM GEE MEMORY LEAKS</span>
<a name="l00029"></a>00029         <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.clear();
<a name="l00030"></a>00030         <a class="code" href="classcPlayMode.html#b957a7765a3ece6fe6b78e7478622f66" title="List of pickups.">pickuplist</a>.clear();
<a name="l00031"></a>00031         <a class="code" href="classcPlayMode.html#145c346df2ec4c8ab123c5a494928f84" title="List of particle systems.">particleslist</a>.clear();
<a name="l00032"></a>00032         <a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a> = *(<span class="keyword">new</span> <a class="code" href="classcPlayTable.html" title="Controls the play table for a game.">cPlayTable</a>(3,7));
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="classcPlayMode.html#1fcc15c62aa9c47cc058215926bb55b5">00035</a> <span class="keywordtype">string</span> <a class="code" href="classcPlayMode.html#1fcc15c62aa9c47cc058215926bb55b5">cPlayMode::mainloop</a>() {
<a name="l00036"></a>00036         
<a name="l00037"></a>00037         <a class="code" href="classcPlayMode.html#6d58169ee910f126d12b826ae865328a">init</a>();
<a name="l00038"></a>00038         
<a name="l00039"></a>00039         <a class="code" href="classcPlayMode.html#7b85783fe75a0a3fefd32eb1e33e9010" title="player x-axis position from 0-1">atime</a> = SDL_GetTicks();
<a name="l00040"></a>00040 <span class="comment">/*      Uint32 frametime = SDL_GetTicks();  //</span>
<a name="l00041"></a>00041 <span class="comment">    Uint32 frames = 0;                 // calc fps*/</span>
<a name="l00042"></a>00042     
<a name="l00043"></a>00043     <span class="keywordtype">string</span> tmpquit;
<a name="l00044"></a>00044     
<a name="l00045"></a>00045         <span class="comment">// into our game loop</span>
<a name="l00046"></a>00046         <span class="keywordflow">while</span>(1) {
<a name="l00047"></a>00047           
<a name="l00048"></a>00048           <a class="code" href="classcPlayMode.html#7b85783fe75a0a3fefd32eb1e33e9010" title="player x-axis position from 0-1">atime</a> = SDL_GetTicks();
<a name="l00049"></a>00049       <span class="keywordflow">if</span> ((tmpquit = <a class="code" href="classcPlayMode.html#ef9d1cbccec777561c8b8000904c4b17" title="Loops through waiting events, then takes keyboard state for arrow keys.">HandleEvents</a>()) != <span class="stringliteral">"continue"</span>) {
<a name="l00050"></a>00050               <span class="keywordflow">return</span> tmpquit;
<a name="l00051"></a>00051       }
<a name="l00052"></a>00052       <a class="code" href="classcPlayMode.html#c14c033539693baad0dd7a8db04a48b8" title="Updates game state.">Update</a>();
<a name="l00053"></a>00053       <a class="code" href="classcPlayMode.html#07d82a908c552ac73b0beb9bfadf801f" title="Performs all the drawing functions.">DrawScreen</a>();
<a name="l00054"></a>00054       
<a name="l00055"></a>00055       SDL_Delay(20);
<a name="l00056"></a>00056       
<a name="l00057"></a>00057       <a class="code" href="main_8cpp.html#bb10fb021d3c0bdc4647fdbec83be1cc">dtime</a> = SDL_GetTicks() - <a class="code" href="classcPlayMode.html#7b85783fe75a0a3fefd32eb1e33e9010" title="player x-axis position from 0-1">atime</a>;
<a name="l00058"></a>00058       
<a name="l00059"></a>00059       <span class="comment">//frames++; if (SDL_GetTicks()-frametime &gt;= 1000) {cout &lt;&lt; frames &lt;&lt; " fps." &lt;&lt; endl; frames = 0; frametime = SDL_GetTicks();} // calc fps.</span>
<a name="l00060"></a>00060       
<a name="l00061"></a>00061         }
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063  
<a name="l00066"></a><a class="code" href="classcPlayMode.html#ef9d1cbccec777561c8b8000904c4b17">00066</a> <span class="keywordtype">string</span> <a class="code" href="classcPlayMode.html#ef9d1cbccec777561c8b8000904c4b17" title="Loops through waiting events, then takes keyboard state for arrow keys.">cPlayMode::HandleEvents</a>() { 
<a name="l00067"></a>00067         <span class="keywordflow">while</span> (SDL_PollEvent (&amp;<a class="code" href="classiGameMode.html#f22aa2105f43f50eb38aab3819305c76">event</a>)) {
<a name="l00068"></a>00068         <span class="keywordflow">switch</span> (<a class="code" href="classiGameMode.html#f22aa2105f43f50eb38aab3819305c76">event</a>.type) {
<a name="l00069"></a>00069           <span class="keywordflow">case</span> SDL_KEYDOWN:
<a name="l00070"></a>00070             <span class="keywordflow">switch</span>(<a class="code" href="classiGameMode.html#f22aa2105f43f50eb38aab3819305c76">event</a>.key.keysym.sym) {
<a name="l00071"></a>00071                 <span class="keywordflow">case</span> SDLK_ESCAPE:
<a name="l00072"></a>00072                     <span class="keywordflow">return</span> <span class="stringliteral">"main_menu"</span>;
<a name="l00073"></a>00073                     <span class="keywordflow">break</span>;
<a name="l00074"></a>00074                 <span class="keywordflow">default</span>:
<a name="l00075"></a>00075                     <span class="keywordflow">break</span>;
<a name="l00076"></a>00076             }
<a name="l00077"></a>00077             <span class="keywordflow">break</span>;
<a name="l00078"></a>00078           <span class="keywordflow">case</span> SDL_MOUSEMOTION:
<a name="l00079"></a>00079                 <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#e30a525ed0d5fd15b0ffda6cbc50237c">bank</a> = -1/(fabs((<a class="code" href="classiGameMode.html#f22aa2105f43f50eb38aab3819305c76">event</a>.motion.x-<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a>*<a class="code" href="main_8cpp.html#a98245788a6490115bfe81e3ccd8934b">SCREEN_WIDTH</a>)/100)+1)+1;
<a name="l00080"></a>00080                 <span class="keywordflow">if</span> (<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a>*<a class="code" href="main_8cpp.html#a98245788a6490115bfe81e3ccd8934b">SCREEN_WIDTH</a> - <a class="code" href="classiGameMode.html#f22aa2105f43f50eb38aab3819305c76">event</a>.motion.x &gt;= 0) <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#e30a525ed0d5fd15b0ffda6cbc50237c">bank</a> = -<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#e30a525ed0d5fd15b0ffda6cbc50237c">bank</a>;
<a name="l00081"></a>00081             <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a> = <span class="keyword">event</span>.motion.x / (float) <a class="code" href="main_8cpp.html#a98245788a6490115bfe81e3ccd8934b">SCREEN_WIDTH</a> ;
<a name="l00082"></a>00082             <span class="keywordflow">break</span>; 
<a name="l00083"></a>00083           <span class="keywordflow">case</span> SDL_QUIT:
<a name="l00084"></a>00084             <span class="keywordflow">return</span> <span class="stringliteral">"quit"</span>;
<a name="l00085"></a>00085             <span class="keywordflow">break</span>;
<a name="l00086"></a>00086           <span class="keywordflow">default</span>:
<a name="l00087"></a>00087             <span class="keywordflow">break</span>;
<a name="l00088"></a>00088         }
<a name="l00089"></a>00089       }
<a name="l00090"></a>00090       <span class="comment">// check state of keyboard  </span>
<a name="l00091"></a>00091       Uint8 *keys = SDL_GetKeyState(NULL);
<a name="l00092"></a>00092       <span class="keywordflow">if</span> (keys[SDLK_LEFT])  (<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a> &lt;= 0) ? <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a> = 0 : <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a> -= 0.001*<a class="code" href="main_8cpp.html#bb10fb021d3c0bdc4647fdbec83be1cc">dtime</a>*<a class="code" href="main_8cpp.html#7f7e4724cf57d59513b39c5ecc81adc8">speed</a>;
<a name="l00093"></a>00093       if (keys[SDLK_RIGHT]) (<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a> &gt;= 1) ? <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a> = 1 : <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a> += 0.001*<a class="code" href="main_8cpp.html#bb10fb021d3c0bdc4647fdbec83be1cc">dtime</a>*<a class="code" href="main_8cpp.html#7f7e4724cf57d59513b39c5ecc81adc8">speed</a>;
<a name="l00094"></a>00094       
<a name="l00095"></a>00095       <span class="keywordflow">return</span> <span class="stringliteral">"continue"</span>;
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00100"></a><a class="code" href="classcPlayMode.html#c14c033539693baad0dd7a8db04a48b8">00100</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#c14c033539693baad0dd7a8db04a48b8" title="Updates game state.">cPlayMode::Update</a>() {
<a name="l00101"></a>00101                 
<a name="l00102"></a>00102         <span class="comment">// update all (generic) objects </span>
<a name="l00103"></a>00103         list&lt; iObject* &gt;::iterator <a class="code" href="classcPlayMode.html#c7008f5aaeea3d65657e43c2145ea27c" title="Iterator for objectlist.">it</a>;  
<a name="l00104"></a>00104         <span class="keywordflow">for</span>(it=<a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.begin(); it != <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.end(); it++) {
<a name="l00105"></a>00105                 (*it)-&gt;update();
<a name="l00106"></a>00106                 <span class="keywordflow">if</span> ((*it)-&gt;deleteme == <span class="keyword">true</span>) {
<a name="l00107"></a>00107                         it=<a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.erase(it);
<a name="l00108"></a>00108                 }       
<a name="l00109"></a>00109         }
<a name="l00110"></a>00110         
<a name="l00111"></a>00111         <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#2dca0dc953b6393a9d792440f3f15b1c">update</a>();
<a name="l00112"></a>00112         <a class="code" href="main_8cpp.html#e3496037f16ba1b4bde4864dc219e026">score</a>.<a class="code" href="classcScore.html#92f9e01ad0f76d1cde18635a7aa9a149">update</a>();
<a name="l00113"></a>00113    
<a name="l00114"></a>00114         list&lt; cPickup* &gt;::iterator <a class="code" href="classcPlayMode.html#2c344bea8d571f06bb1fdd0bdeedb240" title="Iterator for pickuplist.">pt</a>;
<a name="l00115"></a>00115         <span class="keywordflow">for</span> (pt=<a class="code" href="classcPlayMode.html#b957a7765a3ece6fe6b78e7478622f66" title="List of pickups.">pickuplist</a>.begin(); pt != <a class="code" href="classcPlayMode.html#b957a7765a3ece6fe6b78e7478622f66" title="List of pickups.">pickuplist</a>.end(); pt++) {
<a name="l00116"></a>00116           
<a name="l00117"></a>00117                 <span class="comment">// collide pickups with the ship .. </span>
<a name="l00118"></a>00118                 <span class="keywordflow">if</span> (((*pt)-&gt;modelviewmatrix != NULL ) &amp;&amp; ((*pt)-&gt;mode == <a class="code" href="cFlyingPickup_8h.html#ebd8cfefc7021ac352cef3e405e2b22e9b0b4a95b99523966e0e34ffdadac9da">DOWN</a>) &amp;&amp; !(<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#985f513c24da391f170de60730bfe20a">respawning</a>)) {
<a name="l00119"></a>00119                 
<a name="l00120"></a>00120                         <span class="comment">//PrintMatrix(modelviewmatrix);</span>
<a name="l00121"></a>00121                         GLfloat* abbmin = <a class="code" href="utils_8cpp.html#ea2f4fb50d0a88f77eea496d0b6008d3">TransformPoint3fv</a>((*pt)-&gt;modelviewmatrix, <a class="code" href="main_8cpp.html#541823a5a52d1cc3ce1d0a387e51a6ec">block</a>-&gt;<a class="code" href="classc3DSModel.html#1cfde82851950d70a5e0eadc8e3d05b2">bbmin</a>);
<a name="l00122"></a>00122                         GLfloat* abbmax = <a class="code" href="utils_8cpp.html#ea2f4fb50d0a88f77eea496d0b6008d3">TransformPoint3fv</a>((*pt)-&gt;modelviewmatrix, <a class="code" href="main_8cpp.html#541823a5a52d1cc3ce1d0a387e51a6ec">block</a>-&gt;<a class="code" href="classc3DSModel.html#1c5128096ec31f506d3590184bbda00e">bbmax</a>);
<a name="l00123"></a>00123                         GLfloat* sbbmin = <a class="code" href="utils_8cpp.html#ea2f4fb50d0a88f77eea496d0b6008d3">TransformPoint3fv</a>(<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classiObject.html#eaada399d72509651d2fe1e99f69fb02" title="The current modelview transformation for the object.">modelviewmatrix</a>, <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#ad25a15b6a8b0f9bc5787ac5118a349a">model</a>-&gt;<a class="code" href="classc3DSModel.html#1cfde82851950d70a5e0eadc8e3d05b2">bbmin</a>); 
<a name="l00124"></a>00124                         GLfloat* sbbmax = <a class="code" href="utils_8cpp.html#ea2f4fb50d0a88f77eea496d0b6008d3">TransformPoint3fv</a>(<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classiObject.html#eaada399d72509651d2fe1e99f69fb02" title="The current modelview transformation for the object.">modelviewmatrix</a>, <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#ad25a15b6a8b0f9bc5787ac5118a349a">model</a>-&gt;<a class="code" href="classc3DSModel.html#1c5128096ec31f506d3590184bbda00e">bbmax</a>); 
<a name="l00125"></a>00125                         
<a name="l00126"></a>00126                         <span class="keywordflow">if</span> (<a class="code" href="collisions_8cpp.html#18d1a223fa1d962cfc6b7c63e3f83ce9">AABBCollision3D</a>(abbmin, abbmax, sbbmin, sbbmax)) {
<a name="l00127"></a>00127                                 <span class="comment">// add to playtable</span>
<a name="l00128"></a>00128                                 <span class="comment">//playtable.addpickup((*pt)-&gt;lane, (*pt)-&gt;colour);</span>
<a name="l00129"></a>00129                                 
<a name="l00130"></a>00130                                 <span class="comment">// set up particles</span>
<a name="l00131"></a>00131                                 <span class="comment">/*GLfloat startposition[3] = {-8+(*pt)-&gt;lane*8, 5, -100};</span>
<a name="l00132"></a>00132 <span class="comment">                                GLfloat velocity[3] = {0, 0.001, 0.002};</span>
<a name="l00133"></a>00133 <span class="comment">                                GLfloat force[3] = {0, -0.001, 0};</span>
<a name="l00134"></a>00134 <span class="comment">                                cParticleSystem* ps = new cParticleSystem(100, startposition, velocity, 0.3, 0.5, force, color[(*pt)-&gt;colour][0]);</span>
<a name="l00135"></a>00135 <span class="comment">                                //cout &lt;&lt; color[(*pt)-&gt;colour][0][0] &lt;&lt; " " &lt;&lt; color[(*pt)-&gt;colour][0][1] &lt;&lt; " " &lt;&lt; color[(*pt)-&gt;colour][0][2] &lt;&lt; endl; </span>
<a name="l00136"></a>00136 <span class="comment">                                addparticles(ps);*/</span>
<a name="l00137"></a>00137                                 
<a name="l00138"></a>00138                                 <span class="keywordflow">if</span> ((*pt)-&gt;colour == <a class="code" href="includes_8h.html#b470e425c6e2ac234bf5d5f6d8d80595283fc479650da98250635b9c3c0e7e50">WHITE</a>) <a class="code" href="main_8cpp.html#e3496037f16ba1b4bde4864dc219e026">score</a> -= 500;
<a name="l00139"></a>00139                                 
<a name="l00140"></a>00140                                 <span class="comment">// swap pickup for a new pickup that goes to the playtable.</span>
<a name="l00141"></a>00141                                 <a class="code" href="classcPickup.html" title="Encapsulates one pickup.">cPickup</a>* tmpptr = <span class="keyword">new</span> <a class="code" href="classcTPPickup.html" title="&amp;quot;ToPlaytable&amp;quot; Pickup - goes from the ship to the table.">cTPPickup</a>((*pt)-&gt;lane, <a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#2ec2026c1692df6ca72630f531006f67" title="Get the height that a new pickup would drop into in the lane.">getheight</a>((*pt)-&gt;lane), (*pt)-&gt;colour, &amp;(<a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>));
<a name="l00142"></a>00142                                 <span class="keyword">delete</span> (*pt);
<a name="l00143"></a>00143                                 
<a name="l00144"></a>00144                                 <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#4c2125d77ceea73f298004750bbc726f">bump</a>();
<a name="l00145"></a>00145                                 
<a name="l00146"></a>00146                                 list&lt; iObject* &gt;::iterator it = find( <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.begin(), <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.end(), (*pt) );
<a name="l00147"></a>00147                                 (*pt) = tmpptr;
<a name="l00148"></a>00148                                 (*it) = (*pt); 
<a name="l00149"></a>00149                         }               
<a name="l00150"></a>00150                 }
<a name="l00151"></a>00151         
<a name="l00152"></a>00152           <span class="comment">// .. and the edges of the screen.</span>
<a name="l00153"></a>00153           GLdouble mvmatrix[16] = {0};
<a name="l00154"></a>00154           GLdouble pjmatrix[16] = {0};
<a name="l00155"></a>00155           GLint viewport[4] = {0};
<a name="l00156"></a>00156           glGetDoublev(GL_MODELVIEW_MATRIX, mvmatrix);
<a name="l00157"></a>00157           glGetDoublev(GL_PROJECTION_MATRIX, pjmatrix);
<a name="l00158"></a>00158           glGetIntegerv(GL_VIEWPORT, viewport);
<a name="l00159"></a>00159           GLdouble x, y, z;
<a name="l00160"></a>00160           
<a name="l00161"></a>00161           gluProject((*pt)-&gt;x, (*pt)-&gt;y, (*pt)-&gt;z,
<a name="l00162"></a>00162                                 mvmatrix, pjmatrix, viewport,
<a name="l00163"></a>00163                                 &amp;x, &amp;y, &amp;z);
<a name="l00164"></a>00164           <span class="keywordflow">if</span> ((x &lt; 0) || (x &gt; <a class="code" href="main_8cpp.html#a98245788a6490115bfe81e3ccd8934b">SCREEN_WIDTH</a>) ||
<a name="l00165"></a>00165                   (y &lt; 0) || (y &gt; <a class="code" href="main_8cpp.html#a98245788a6490115bfe81e3ccd8934b">SCREEN_WIDTH</a>)) {
<a name="l00166"></a>00166                 <span class="keyword">delete</span> (*pt); list&lt; iObject* &gt;::iterator it = find( <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.begin(), <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.end(), (*pt) );
<a name="l00167"></a>00167                 pt = <a class="code" href="classcPlayMode.html#b957a7765a3ece6fe6b78e7478622f66" title="List of pickups.">pickuplist</a>.erase(pt); 
<a name="l00168"></a>00168                 <span class="keywordflow">if</span> (it != <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.end()) {
<a name="l00169"></a>00169                         <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.erase(it);
<a name="l00170"></a>00170                 } <span class="keywordflow">else</span> {
<a name="l00171"></a>00171                         cout &lt;&lt; <span class="stringliteral">"warning: pickup not found in objectlist"</span> &lt;&lt; endl;
<a name="l00172"></a>00172                 }
<a name="l00173"></a>00173           }
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175         
<a name="l00176"></a>00176         <span class="comment">// update our playnodes</span>
<a name="l00177"></a>00177         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#a65fbae569cdf0f810b537a1bd499509" title="Table width (number of lanes/columns.">width</a>; i++) {
<a name="l00178"></a>00178                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#693b82809e396814bb322cc1777886c8" title="Table height (number of rows).">height</a>; j++) {
<a name="l00179"></a>00179                         <a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#54ff15f6b4629745c7f0206a822be4c9" title="Where table data is stored.">positions</a>[i][j]-&gt;update();
<a name="l00180"></a>00180                         
<a name="l00181"></a>00181                         <span class="comment">// check for unstable nodes (release them)</span>
<a name="l00182"></a>00182                         <span class="keywordflow">while</span> (<a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#54ff15f6b4629745c7f0206a822be4c9" title="Where table data is stored.">positions</a>[i][j]-&gt;unstable == 1) {
<a name="l00183"></a>00183                                 <span class="keywordflow">if</span> (<a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#54ff15f6b4629745c7f0206a822be4c9" title="Where table data is stored.">positions</a>[i][j]-&gt;colour != <a class="code" href="includes_8h.html#b470e425c6e2ac234bf5d5f6d8d80595283fc479650da98250635b9c3c0e7e50">WHITE</a>) { 
<a name="l00184"></a>00184                                         <a class="code" href="classcPickup.html" title="Encapsulates one pickup.">cPickup</a>* newpickup = <span class="keyword">new</span> <a class="code" href="classcScorePickup.html">cScorePickup</a>(i, j, <a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#54ff15f6b4629745c7f0206a822be4c9" title="Where table data is stored.">positions</a>[i][j]-&gt;colour);
<a name="l00185"></a>00185                                         <a class="code" href="classcPlayMode.html#0800c98891eb91f1ea0622ef6eaefb5b" title="Add a pickup to the manager.">addpickup</a>(newpickup);
<a name="l00186"></a>00186                                 }
<a name="l00187"></a>00187                                 <a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#c83bd4ea839e52ef6c263842e99561bb" title="Delete a certain pickup from the table.">deletepickup</a>(i, j);
<a name="l00188"></a>00188                         }
<a name="l00189"></a>00189                 }
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191         <a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#730a8698ef050d4068181927b76367f0" title="Update the table.">update</a>();
<a name="l00192"></a>00192         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#a65fbae569cdf0f810b537a1bd499509" title="Table width (number of lanes/columns.">width</a>; i++) {
<a name="l00193"></a>00193                 <span class="keywordflow">if</span> (<a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#1ebe92ea69902ab75cefb4a259d36500" title="Whether a lane has overfilled or not.">statuses</a>[i] == <a class="code" href="cPlayTable_8h.html#50d06ece9e639ef598d775b92153a1232794bf685b2d16f66059ae845e72243e">PT_OVERFILL</a>) {
<a name="l00194"></a>00194                         <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#b81ead0447287bdf01bac63675960502">respawn</a>();
<a name="l00195"></a>00195                         <a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#1ebe92ea69902ab75cefb4a259d36500" title="Whether a lane has overfilled or not.">statuses</a>[i] = <a class="code" href="cPlayTable_8h.html#50d06ece9e639ef598d775b92153a123d07683ffcb8a1fdcbb5e3786f9772bfc">PT_FINE</a>;
<a name="l00196"></a>00196                 }       
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198         <span class="keywordflow">if</span> (<a class="code" href="main_8cpp.html#e3496037f16ba1b4bde4864dc219e026">score</a> &lt; 0) <a class="code" href="main_8cpp.html#e3496037f16ba1b4bde4864dc219e026">score</a> = 0;
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00203"></a><a class="code" href="classcPlayMode.html#07d82a908c552ac73b0beb9bfadf801f">00203</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#07d82a908c552ac73b0beb9bfadf801f" title="Performs all the drawing functions.">cPlayMode::DrawScreen</a>() {
<a name="l00204"></a>00204         glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT );
<a name="l00205"></a>00205         
<a name="l00206"></a>00206         <span class="comment">// reset position</span>
<a name="l00207"></a>00207         glLoadIdentity();
<a name="l00208"></a>00208         
<a name="l00209"></a>00209         <span class="comment">//camera transform</span>
<a name="l00210"></a>00210         gluLookAt((<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a>-0.5)*2, 4, 10,
<a name="l00211"></a>00211                   (<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a>-0.5)*2, 0, -30,
<a name="l00212"></a>00212                   0, 1, 0);
<a name="l00213"></a>00213         
<a name="l00214"></a>00214         <span class="comment">//draw the player</span>
<a name="l00215"></a>00215         glPushMatrix(); 
<a name="l00216"></a>00216                 <a class="code" href="classcPlayMode.html#a58a982ce0b3a6fe868a282f8e21ea1f">drawship</a>();
<a name="l00217"></a>00217         glPopMatrix();
<a name="l00218"></a>00218         
<a name="l00219"></a>00219          <span class="comment">//draw objects </span>
<a name="l00220"></a>00220          glPushMatrix();        
<a name="l00221"></a>00221                 <span class="keywordflow">if</span> (<a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.size() != 0) {
<a name="l00222"></a>00222                   <span class="keywordflow">for</span>(<a class="code" href="classcPlayMode.html#c7008f5aaeea3d65657e43c2145ea27c" title="Iterator for objectlist.">it</a>=<a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.begin(); <a class="code" href="classcPlayMode.html#c7008f5aaeea3d65657e43c2145ea27c" title="Iterator for objectlist.">it</a> != <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.end(); <a class="code" href="classcPlayMode.html#c7008f5aaeea3d65657e43c2145ea27c" title="Iterator for objectlist.">it</a>++) {
<a name="l00223"></a>00223                         glPushMatrix();
<a name="l00224"></a>00224                         (*it)-&gt;draw();
<a name="l00225"></a>00225                         glPopMatrix();
<a name="l00226"></a>00226                   }
<a name="l00227"></a>00227                 } 
<a name="l00228"></a>00228                 <a class="code" href="classcPlayMode.html#46fe6515d20782d450b9f818cd420aac" title="The playtable for the game.">playtable</a>.<a class="code" href="classcPlayTable.html#18b298f56e3d9051287deda5ef42c8d5" title="Draw the table.">draw</a>();
<a name="l00229"></a>00229          glPopMatrix();
<a name="l00230"></a>00230          
<a name="l00231"></a>00231         <span class="comment">//draw track</span>
<a name="l00232"></a>00232         glPushMatrix();
<a name="l00233"></a>00233          <a class="code" href="classcPlayMode.html#afd239dd1f761b74e218096b013e74e0">drawtrack</a>();
<a name="l00234"></a>00234         glPopMatrix();
<a name="l00235"></a>00235          
<a name="l00236"></a>00236          <span class="comment">//draw text</span>
<a name="l00237"></a>00237         <span class="keywordtype">char</span> out[20];
<a name="l00238"></a>00238         sprintf(out, <span class="stringliteral">"%li"</span>, <a class="code" href="main_8cpp.html#e3496037f16ba1b4bde4864dc219e026">score</a>.<a class="code" href="classcScore.html#888d47f2a0ee736afcaa8deb68e3587b">get</a>()); <span class="comment">// %li - long int </span>
<a name="l00239"></a>00239         <a class="code" href="classcPlayMode.html#5b40786f649407640a94b3ab076a8a02">DrawText</a>(out, (<a class="code" href="main_8cpp.html#a98245788a6490115bfe81e3ccd8934b">SCREEN_WIDTH</a> - <a class="code" href="classcPlayMode.html#bd1bf3742024993a1aaee6fc70d9e582">font</a>-&gt;<a class="code" href="classcFont.html#db887874b958978527114541246bcbf6" title="Returns the width in pixels of the given string if using the current font.">string_width</a>(out))/2, <a class="code" href="main_8cpp.html#f8f084ceac8b2c3fac0961c5bcd3c73c">SCREEN_HEIGHT</a>-40);
<a name="l00240"></a>00240         
<a name="l00241"></a>00241         <span class="comment">//finally, swap out to the screen.</span>
<a name="l00242"></a>00242         SDL_GL_SwapBuffers();
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="classcPlayMode.html#a58a982ce0b3a6fe868a282f8e21ea1f">00245</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#a58a982ce0b3a6fe868a282f8e21ea1f">cPlayMode::drawship</a>() {
<a name="l00246"></a>00246         glTranslatef( (-0.5+<a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#508f13231ac102dce4369c2540d40ae2">xpos</a>)*<a class="code" href="cPlayMode_8h.html#17ba318b703c9027c95a42f7592b2815">NORMAL_TRACK_WIDTH</a>, 0, 0); <span class="comment">// this is here (outside of cShip) </span>
<a name="l00247"></a>00247                                                                                 <span class="comment">//since the track width is different for different modes.</span>
<a name="l00248"></a>00248         <a class="code" href="classcPlayMode.html#476358dd379019dcfbe68cbd3581da9b">ship</a>.<a class="code" href="classcShip.html#d8a161c66b9a857e1f2bf3bfab1d0b40">draw</a>();
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00251"></a><a class="code" href="classcPlayMode.html#afd239dd1f761b74e218096b013e74e0">00251</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#afd239dd1f761b74e218096b013e74e0">cPlayMode::drawtrack</a>() {
<a name="l00252"></a>00252         
<a name="l00253"></a>00253                 <a class="code" href="classcPlayMode.html#10bf623113220fed3280c2c119116531">trackdisp</a> += 0.06*<a class="code" href="main_8cpp.html#bb10fb021d3c0bdc4647fdbec83be1cc">dtime</a>*<a class="code" href="main_8cpp.html#7f7e4724cf57d59513b39c5ecc81adc8">speed</a>;
<a name="l00254"></a>00254                 <span class="keywordflow">if</span> (<a class="code" href="classcPlayMode.html#10bf623113220fed3280c2c119116531">trackdisp</a> &gt; 18) <a class="code" href="classcPlayMode.html#10bf623113220fed3280c2c119116531">trackdisp</a> -= 18;
<a name="l00255"></a>00255                 glTranslatef(0, 0, 20+<a class="code" href="classcPlayMode.html#10bf623113220fed3280c2c119116531">trackdisp</a>);
<a name="l00256"></a>00256                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;100; i++) {
<a name="l00257"></a>00257                         <a class="code" href="main_8cpp.html#ae56bde25963ab1b5b2ed66cd90e69d3">track</a>-&gt;<a class="code" href="classc3DSModel.html#f75412da827e3e8bd005d0a363aa57c2">Draw</a>();
<a name="l00258"></a>00258                         glTranslatef(0, 0, -18);
<a name="l00259"></a>00259                 }
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a><a class="code" href="classcPlayMode.html#5b40786f649407640a94b3ab076a8a02">00262</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#5b40786f649407640a94b3ab076a8a02">cPlayMode::DrawText</a>(<span class="keywordtype">char</span>* text, <span class="keywordtype">int</span> xpos, <span class="keywordtype">int</span> ypos) { 
<a name="l00263"></a>00263         
<a name="l00264"></a>00264         glMatrixMode(GL_PROJECTION);
<a name="l00265"></a>00265          glPushMatrix();
<a name="l00266"></a>00266          glLoadIdentity();
<a name="l00267"></a>00267          glOrtho(0,<a class="code" href="main_8cpp.html#a98245788a6490115bfe81e3ccd8934b">SCREEN_WIDTH</a>,0,<a class="code" href="main_8cpp.html#f8f084ceac8b2c3fac0961c5bcd3c73c">SCREEN_HEIGHT</a>,-1, 1);
<a name="l00268"></a>00268         glMatrixMode(GL_MODELVIEW);
<a name="l00269"></a>00269          glPushMatrix();
<a name="l00270"></a>00270          glLoadIdentity();
<a name="l00271"></a>00271          glTranslatef(xpos,ypos,0);
<a name="l00272"></a>00272           glDisable(GL_LIGHTING);
<a name="l00273"></a>00273           glDisable(GL_BLEND);
<a name="l00274"></a>00274            <a class="code" href="classcPlayMode.html#bd1bf3742024993a1aaee6fc70d9e582">font</a>-&gt;<a class="code" href="classcFont.html#013a0398de4b769106b7f473751171ad" title="Draw a string at the current coordinates.">draw</a>(text);
<a name="l00275"></a>00275           glEnable(GL_BLEND);
<a name="l00276"></a>00276           glEnable(GL_LIGHTING);
<a name="l00277"></a>00277         glMatrixMode(GL_PROJECTION);
<a name="l00278"></a>00278          glPopMatrix();   
<a name="l00279"></a>00279         glMatrixMode(GL_MODELVIEW);
<a name="l00280"></a>00280          glPopMatrix();
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a><a class="code" href="classcPlayMode.html#9394975a38f9fd679f85bd8052991e97">00283</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#9394975a38f9fd679f85bd8052991e97">cPlayMode::CreatePickups</a>() {
<a name="l00284"></a>00284         
<a name="l00285"></a>00285         Uint32 <a class="code" href="classcPlayMode.html#5cc183c54a1035c87f5a2cdd02b08ece">newobjecttimer</a> = SDL_GetTicks();
<a name="l00286"></a>00286         <span class="keywordtype">int</span> <a class="code" href="classcPlayMode.html#2fd1772ddc1b0c497e42e211fc062ed1">pickupcount</a> = 0;
<a name="l00287"></a>00287         <span class="keywordflow">while</span> (1) {
<a name="l00288"></a>00288                 <span class="keywordflow">if</span> (<a class="code" href="classcPlayMode.html#de014c8a7beb686a36ea11ae5be57116">quit_createpickup_thread</a>) <span class="keywordflow">break</span>;
<a name="l00289"></a>00289                 
<a name="l00290"></a>00290                 <span class="keywordflow">if</span> (SDL_GetTicks() - newobjecttimer &gt;= 250) {
<a name="l00291"></a>00291                         <span class="keywordflow">if</span> (pickupcount == 0) {
<a name="l00292"></a>00292                                 <span class="keywordflow">if</span> (<a class="code" href="includes_8cpp.html#5d595d84d8fbac52afb180d70fd06223">GenerateRandomNumber</a>(1, 6) == 1) { 
<a name="l00293"></a>00293                                         <a class="code" href="classcPlayMode.html#508e0cbf73c071e90cfcfe84d7b111ca" title="The current pickup (lane) position.">currentposition</a> = <a class="code" href="includes_8cpp.html#5d595d84d8fbac52afb180d70fd06223">GenerateRandomNumber</a>(0,2);
<a name="l00294"></a>00294                                         <a class="code" href="classcPlayMode.html#cb3bf89d91bdc776c9afd47d2d97646b" title="The current pickup colour.">currentcolour</a> = <a class="code" href="includes_8cpp.html#5d595d84d8fbac52afb180d70fd06223">GenerateRandomNumber</a>(1,5);
<a name="l00295"></a>00295                                         pickupcount = <a class="code" href="includes_8cpp.html#5d595d84d8fbac52afb180d70fd06223">GenerateRandomNumber</a> (1,2);
<a name="l00296"></a>00296                                 }               
<a name="l00297"></a>00297                         } <span class="keywordflow">else</span> {
<a name="l00298"></a>00298                                 <span class="comment">// add pickups</span>
<a name="l00299"></a>00299                                 <span class="keyword">static</span> <span class="keywordtype">int</span> onepickup = 0;
<a name="l00300"></a>00300                                 <a class="code" href="classcPickup.html" title="Encapsulates one pickup.">cPickup</a>* newpickup;
<a name="l00301"></a>00301                                 newpickup = <span class="keyword">new</span> <a class="code" href="classcDownPickup.html">cDownPickup</a>(<a class="code" href="classcPlayMode.html#508e0cbf73c071e90cfcfe84d7b111ca" title="The current pickup (lane) position.">currentposition</a>, <a class="code" href="classcPlayMode.html#cb3bf89d91bdc776c9afd47d2d97646b" title="The current pickup colour.">currentcolour</a>); 
<a name="l00302"></a>00302                                 <span class="comment">//newpickup = new cPickup(currentposition, 0, 1, DOWN); // use this for all red pickups. Debugging purposes.</span>
<a name="l00303"></a>00303                                 <span class="comment">//if (onepickup==0) // use this for only one pickup. Debugging purposes.</span>
<a name="l00304"></a>00304                                 <a class="code" href="classcPlayMode.html#0800c98891eb91f1ea0622ef6eaefb5b" title="Add a pickup to the manager.">addpickup</a>(newpickup); 
<a name="l00305"></a>00305                                 onepickup = 1;
<a name="l00306"></a>00306                                 pickupcount--;
<a name="l00307"></a>00307                         }
<a name="l00308"></a>00308                         newobjecttimer = SDL_GetTicks();
<a name="l00309"></a>00309                 } 
<a name="l00310"></a>00310                 SDL_Delay(20);
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a><a class="code" href="cPlayMode_8h.html#136b13e275d28e2afadf49e2ca319a76">00314</a> <span class="keywordtype">int</span> <a class="code" href="cPlayMode_8cpp.html#3d00ff2c7c81826b98c3c861c1a9d416">generate_pickups_thread</a>(<span class="keywordtype">void</span>* playmode) {
<a name="l00315"></a>00315         <a class="code" href="classcPlayMode.html">cPlayMode</a>* pm = (<a class="code" href="classcPlayMode.html">cPlayMode</a>*)playmode;
<a name="l00316"></a>00316         pm-&gt;<a class="code" href="classcPlayMode.html#9394975a38f9fd679f85bd8052991e97">CreatePickups</a>();
<a name="l00317"></a>00317         <span class="keywordflow">return</span> 0;
<a name="l00318"></a>00318 }
<a name="l00319"></a>00319 
<a name="l00320"></a><a class="code" href="classcPlayMode.html#4c98f9b9bbc1e25b1cd105f794f7cb08">00320</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#4c98f9b9bbc1e25b1cd105f794f7cb08" title="Add a generic object to the manager.">cPlayMode::add</a>(<a class="code" href="classiObject.html" title="Provides a basic object interface.">iObject</a>* <span class="keywordtype">object</span>) {
<a name="l00321"></a>00321         <a class="code" href="classcPlayMode.html#8cf5ca096845567e86865f08dc2df67a" title="List of all objects managed by cPlayMode.">objectlist</a>.push_back(<span class="keywordtype">object</span>);
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a><a class="code" href="classcPlayMode.html#0800c98891eb91f1ea0622ef6eaefb5b">00324</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#0800c98891eb91f1ea0622ef6eaefb5b" title="Add a pickup to the manager.">cPlayMode::addpickup</a>(<a class="code" href="classcPickup.html" title="Encapsulates one pickup.">cPickup</a>* pickup) {
<a name="l00325"></a>00325         <a class="code" href="classcPlayMode.html#b957a7765a3ece6fe6b78e7478622f66" title="List of pickups.">pickuplist</a>.push_back(pickup);
<a name="l00326"></a>00326         <span class="keyword">add</span>(pickup);
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 
<a name="l00329"></a><a class="code" href="classcPlayMode.html#c819e53339236e55656bdcfcd457d617">00329</a> <span class="keywordtype">void</span> <a class="code" href="classcPlayMode.html#c819e53339236e55656bdcfcd457d617">cPlayMode::addparticles</a>(<a class="code" href="classcParticleSystem.html">cParticleSystem</a>* particles) {
<a name="l00330"></a>00330         <a class="code" href="classcPlayMode.html#145c346df2ec4c8ab123c5a494928f84" title="List of particle systems.">particleslist</a>.push_back(particles);
<a name="l00331"></a>00331         <span class="keyword">add</span>(particles); 
<a name="l00332"></a>00332 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Aug 6 17:59:51 2008 for Soundboard (audiosurf clone) (temporary name) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
